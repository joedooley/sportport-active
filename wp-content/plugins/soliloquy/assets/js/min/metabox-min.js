!function($){$(function(){function o(o){$(".media-toolbar-secondary span.soliloquy-spinner").css("visibility","visible"),$.post(soliloquy_metabox.ajax,{action:"soliloquy_load_library",offset:o,post_id:soliloquy_metabox.id,search:$("input#soliloquy-slider-search").val(),nonce:soliloquy_metabox.load_slider},function(t){$("a.soliloquy-load-library").attr("data-soliloquy-offset",Number(o)+20),$(".media-toolbar-secondary span.soliloquy-spinner").css("visibility","hidden"),0===o?$(".soliloquy-slider").html(t.html):$(".soliloquy-slider").append(t.html)},"json")}function t(o){var t="";return t+='<div class="soliloquy-video-slide-holder"><p class="no-margin-top"><a href="#" class="button button-secondary soliloquy-delete-video-slide" title="'+soliloquy_metabox.removeslide+'">'+soliloquy_metabox.removeslide+'</a><label for="soliloquy-video-slide-'+o+'-title"><strong>'+soliloquy_metabox.videoslide+'</strong></label><br /><input type="text" class="soliloquy-video-slide-title" id="soliloquy-video-slide-'+o+'-title" value="" placeholder="'+soliloquy_metabox.videoplace+'" /></p><p><label for="soliloquy-video-slide-'+o+'"><strong>'+soliloquy_metabox.videotitle+'</strong></label><br /><input type="text" class="soliloquy-video-slide-url" id="soliloquy-video-slide-'+o+'" value="" placeholder="'+soliloquy_metabox.videooutput+'" /></p><p><label for="soliloquy-video-slide-'+o+'-thumbnail"><strong>'+soliloquy_metabox.videothumb+'</strong></label><br /><input type="text" class="soliloquy-video-slide-thumbnail soliloquy-src" id="soliloquy-video-slide-'+o+'-thumbnail" value="" placeholder="'+soliloquy_metabox.videosrc+'" /> <span><a href="#" class="soliloquy-thumbnail button button-primary" data-field="soliloquy-src">'+soliloquy_metabox.videoselect+'</a> <a href="#" class="soliloquy-thumbnail-delete button button-secondary" data-field="soliloquy-src">'+soliloquy_metabox.videodelete+'</a></span></p><p class="no-margin-bottom"><label for="soliloquy-video-slide-'+o+'-caption"><strong>'+soliloquy_metabox.videocaption+'</strong></label><br /><textarea class="soliloquy-video-slide-caption" id="soliloquy-video-slide-'+o+'-caption"></textarea></p></div>'}function l(o){var t="";return t+='<div class="soliloquy-html-slide-holder"><p class="no-margin-top"><a href="#" class="button button-secondary soliloquy-delete-html-slide" title="'+soliloquy_metabox.removeslide+'">'+soliloquy_metabox.removeslide+'</a><label for="soliloquy-html-slide-'+o+'-title"><strong>'+soliloquy_metabox.htmlslide+'</strong></label><br /><input type="text" class="soliloquy-html-slide-title" id="soliloquy-html-slide-'+o+'-title" value="" placeholder="'+soliloquy_metabox.htmlplace+'" /></p><p class="no-margin-bottom"><label for="soliloquy-html-slide-'+o+'"><strong>'+soliloquy_metabox.htmlcode+'</strong></label><br /><textarea class="soliloquy-html-slide-code" id="soliloquy-html-slide-'+o+'">'+soliloquy_metabox.htmlstart+"</textarea></div>"}function e(){var o={action:"soliloquy_refresh",post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.refresh_nonce};$(".soliloquy-media-library").after('<span class="spinner soliloquy-spinner soliloquy-spinner-refresh"></span>'),$(".soliloquy-spinner-refresh").css({display:"inline-block","margin-top":"-3px"}),$.post(soliloquy_metabox.ajax,o,function(o){o&&o.success&&($("#soliloquy-output").html(o.success),$("#soliloquy-output").find(".wp-editor-wrap").each(function(o,t){var l=$(t).find(".quicktags-toolbar");if(!(l.length>0)){var e=$(t).attr("id").split("-"),i=e.slice(3,-1).join("-");quicktags({id:"soliloquy-caption-"+i,buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()}}),$(".soliloquy-html").find(".soliloquy-html-code").each(function(o,t){var l=$(t).attr("id");d[l]=CodeMirror.fromTextArea(t,{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"solarized dark"}),d[l].on("blur",function(o){$("#"+l).text(o.getValue())}),d[l].refresh()}),$("#soliloquy-output").trigger({type:"soliloquyRefreshed",html:o.success,id:soliloquy_metabox.id})),$(".soliloquy-spinner-refresh").fadeOut(300,function(){$(this).remove()})},"json")}var i=$("#soliloquy-tabs"),a=$("#soliloquy-tabs-nav"),s=window.location.hash,n=window.location.hash.replace("!","");if(s&&s.indexOf("soliloquy-tab-")>=0){$(".soliloquy-active").removeClass("soliloquy-active"),a.find('li a[href="'+n+'"]').parent().addClass("soliloquy-active"),i.find(n).addClass("soliloquy-active").show();var u=$("#post").attr("action");u&&(u=u.split("#")[0],$("#post").attr("action",u+s))}$("input,select").conditional(),$(document).on("click","#soliloquy-tabs-nav li a",function(o){o.preventDefault();var t=$(this);if(!t.parent().hasClass("soliloquy-active")){window.location.hash=s=this.hash.split("#").join("#!");var l=a.find(".soliloquy-active").removeClass("soliloquy-active").find("a").attr("href");t.parent().addClass("soliloquy-active"),i.find(l).removeClass("soliloquy-active").hide(),i.find(t.attr("href")).addClass("soliloquy-active").show();var e=$("#post").attr("action");e&&(e=e.split("#")[0],$("#post").attr("action",e+s))}}),0!==$(".soliloquy-helper-needed").length&&$('<div class="soliloquy-meta-helper-overlay" />').prependTo("#soliloquy"),$(document).on("click",".soliloquy-meta-icon",function(o){o.preventDefault();var t=$(this),l=t.parent(),e=t.next();e.is(":visible")?($(".soliloquy-meta-helper-overlay").remove(),l.removeClass("soliloquy-helper-active")):(0===$(".soliloquy-meta-helper-overlay").length&&$('<div class="soliloquy-meta-helper-overlay" />').prependTo("#soliloquy"),l.addClass("soliloquy-helper-active"))}),$(document).on("change",'input[name="_soliloquy[type]"]:radio',function(o){var t=$(this);$(".soliloquy-type-spinner .soliloquy-spinner").css({display:"inline-block","margin-top":"-1px"});var l={action:"soliloquy_change_type",post_id:soliloquy_metabox.id,type:t.val(),nonce:soliloquy_metabox.change_nonce};$.post(soliloquy_metabox.ajax,l,function(o){"default"==o.type?$("#soliloquy-slider-main").html(o.html):$("#soliloquy-slider-main").html(o.html),$(document).trigger("soliloquySliderType",o),$(".soliloquy-type-spinner .soliloquy-spinner").hide()},"json")}),$(document).on("click",".soliloquy-media-library",function(o){o.preventDefault(),$("#soliloquy-upload-ui").appendTo("body").show()}),$(".soliloquy-slider").on("click",".thumbnail, .check, .media-modal-icon",function(o){o.preventDefault(),$(this).parent().parent().hasClass("soliloquy-in-slider")||($(this).parent().parent().hasClass("selected")?$(this).parent().parent().removeClass("details selected"):$(this).parent().parent().addClass("details selected"))}),$(document).on("click","a.soliloquy-load-library",function(t){o($("a.soliloquy-load-library").attr("data-soliloquy-offset"))}),$(".soliloquy-slider").bind("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight&&o($("a.soliloquy-load-library").attr("data-soliloquy-offset"))}),$(document).on("keyup keydown","#soliloquy-slider-search",function(){p(function(){o(0)})}),$(document).on("click",".soliloquy-media-insert",function(o){o.preventDefault();var t=$(this),l=t.text(),e={action:"soliloquy_insert_slides",nonce:soliloquy_metabox.insert_nonce,post_id:soliloquy_metabox.id,images:{},videos:{},html:{}},i=!1,a=!1,s=!1,n=o;t.text(soliloquy_metabox.inserting),$(".soliloquy-media-frame").find(".attachment.selected:not(.soliloquy-in-slider)").each(function(o,t){e.images[o]=$(t).attr("data-attachment-id"),i=!0}),$(".soliloquy-media-frame").find(".soliloquy-video-slide-holder").each(function(o,t){e.videos[o]={title:$(t).find(".soliloquy-video-slide-title").val(),url:$(t).find(".soliloquy-video-slide-url").val(),src:$(t).find(".soliloquy-video-slide-thumbnail").val(),caption:$(t).find(".soliloquy-video-slide-caption").val()},a=!0}),$(".soliloquy-media-frame").find(".soliloquy-html-slide-holder").each(function(o,t){e.html[o]={title:$(t).find(".soliloquy-html-slide-title").val(),code:$(t).find(".soliloquy-html-slide-code").val()},s=!0}),$.post(soliloquy_metabox.ajax,e,function(o){setTimeout(function(){f(n),t.text(l),i&&$(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click")},500)},"json")}),$(document).on("click",".soliloquy-media-frame .media-menu-item",function(o){o.preventDefault();var t=$(this),l=t.parent().find(".active").removeClass("active").data("soliloquy-content"),e=t.addClass("active").data("soliloquy-content");$("#soliloquy-"+l).hide(),$("#soliloquy-"+e).show()}),$(document).on("click",".soliloquy-add-video-slide",function(o){o.preventDefault();var l=parseInt($(this).attr("data-soliloquy-video-number")),e="soliloquy-video-slide-"+$(this).attr("data-soliloquy-html-number");$(this).attr("data-soliloquy-video-number",l+1).parent().before(t(l))}),$(document).on("click","#soliloquy-video-slides .soliloquy-delete-video-slide",function(o){o.preventDefault(),$(this).parent().parent().remove()});var d={};$(".soliloquy-html").find(".soliloquy-html-code").each(function(o,t){var l=$(t).attr("id");d[l]=CodeMirror.fromTextArea(t,{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"solarized dark"}),d[l].on("blur",function(o){$("#"+l).text(o.getValue())}),d[l].on("change",function(o){h(l,o.getValue())})}),$(document).on("click",".soliloquy-add-html-slide",function(o){o.preventDefault();var t=parseInt($(this).attr("data-soliloquy-html-number")),e="soliloquy-html-slide-"+$(this).attr("data-soliloquy-html-number");$(this).attr("data-soliloquy-html-number",t+1).parent().before(l(t)),d[e]=CodeMirror.fromTextArea(document.getElementById(e),{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"solarized dark"}),d[e].on("blur",function(o){$("#"+e).text(o.getValue())}),d[e].on("change",function(o){h(e,o.getValue())})});var r=$("#soliloquy-output");r.sortable({containment:"#soliloquy",items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",update:function(o,t){var l={url:soliloquy_metabox.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_sort_images",order:r.sortable("toArray").toString(),post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.sort},success:function(o){},error:function(o,t,l){}};$.ajax(l)}}),$(document).on("click","#soliloquy .soliloquy-remove-slide",function(o){o.preventDefault();var t=confirm(soliloquy_metabox.remove);if(t){var l=$(this).parent().attr("id"),e={action:"soliloquy_remove_slide",attachment_id:l,post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.remove_nonce};$.post(soliloquy_metabox.ajax,e,function(o){$("#"+l).fadeOut("normal",function(){$(this).remove(),$(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click")})},"json")}});var c=[];$(document).on("click.soliloquyModify",".soliloquy-modify-slide",function(o){o.preventDefault();var t=$(this).parent().data("soliloquy-slide"),l="soliloquy-meta-"+t;c=[],$("ul#soliloquy-output li").each(function(){c.push($(this).data("soliloquy-slide"))}),y(t,l)}),$(document).on("click","button.left, button.right",function(o){o.preventDefault(),q();var t=$(this).attr("data-attachment-id"),l="soliloquy-meta-"+t;y(t,l)});var m,y=function(o,t){m=$("#"+t).appendTo("body"),$(m).show(),$("button.left",$(m)).removeClass("disabled"),$("button.right",$(m)).removeClass("disabled");for(var l=-1,e=0;e<c.length;e++)if(c[e]==o){l=e;break}0==l?($("button.left",$(m)).addClass("disabled"),$("button.left",$(m)).attr("data-attachment-id",""),c.length>1?($("button.right",$(m)).removeClass("disabled"),$("button.right",$(m)).attr("data-attachment-id",c[l+1])):($("button.right",$(m)).addClass("disabled"),$("button.right",$(m)).attr("data-attachment-id",""))):l==c.length-1?($("button.left",$(m)).removeClass("disabled"),$("button.left",$(m)).attr("data-attachment-id",c[l-1]),$("button.right",$(m)).addClass("disabled"),$("button.right",$(m)).attr("data-attachment-id","")):($("button.left",$(m)).removeClass("disabled"),$("button.left",$(m)).attr("data-attachment-id",c[l-1]),$("button.right",$(m)).removeClass("disabled"),$("button.right",$(m)).attr("data-attachment-id",c[l+1])),"undefined"!=typeof d["soliloquy-code-"+o]&&d["soliloquy-code-"+o].refresh()};$(document).on("click",".soliloquy-thumbnail",function(o){o.preventDefault();var t=$(this).data("field"),l=wp.media.frames.soliloquy_media_frame=wp.media({className:"media-frame soliloquy-media-frame",frame:"select",multiple:!1,title:soliloquy_metabox.videoframe,library:{type:"image"},button:{text:soliloquy_metabox.videouse}}),e=$(this);l.on("select",function(){var o=l.state().get("selection").first().toJSON();$("input."+t,e.closest(".media-frame-content")).val(o.url).trigger("change")}),l.open()}),$(document).on("change","input.soliloquy-src, input.soliloquy-thumb",function(o){var t=$(this).data("soliloquy-meta");$("div.thumbnail > img."+t,$(this).closest(".media-frame-content")).attr("src",$(this).val())}),$(document).on("click",".soliloquy-thumbnail-delete",function(o){o.preventDefault();var t=$(this).data("field");$("input."+t,$(this).closest(".media-frame-content")).val("").trigger("change")});var h=function(o,t){var l=o.replace("soliloquy-code-","#soliloquy-meta-table-");$(".attachment-media-view .thumbnail",$(l)).html(t)};$(document).on("click",".media-modal-close, .media-modal-backdrop",function(o){o.preventDefault(),q()}),$(document).on("keydown",function(o){27==o.keyCode&&q()});var q=function(){var o=$(m).attr("id");if("undefined"==typeof o)$("#soliloquy-upload-ui").appendTo("#soliloquy-upload-ui-wrapper").hide();else{var t=o.replace("soliloquy-meta-","");$("#"+o).appendTo("#"+t).hide()}};$(document).on("click",".soliloquy-meta-submit",function(o){o.preventDefault();var t=$(this),l=t.text(),e=t.data("soliloquy-item"),i="soliloquy-meta-"+e,a={},s=$("span.settings-save-status span.spinner"),n=$("span.settings-save-status span.saved");t.text(soliloquy_metabox.saving),t.attr("disabled","disabled"),$(s).show(),a.caption=$("#soliloquy-meta-table-"+e).find('textarea[name="_soliloquy[meta_caption]"]').val(),$("#soliloquy-meta-table-"+e).find(":input,select").not(".ed_button").each(function(o,t){$(this).data("soliloquy-meta")&&("checkbox"==$(this).attr("type")||"radio"==$(this).attr("type")?a[$(this).data("soliloquy-meta")]=$(this).is(":checked")?1:0:"select"==$(this).attr("type")?a[$(this).data("soliloquy-meta")]=$(this).find(":selected").val():a[$(this).data("soliloquy-meta")]=$(this).val())});var u={action:"soliloquy_save_meta",nonce:soliloquy_metabox.save_nonce,attach_id:e,post_id:soliloquy_metabox.id,meta:a};$.post(soliloquy_metabox.ajax,u,function(o){"undefined"!=typeof a.src&&$("li#"+e+" img").attr("src",a.src),"undefined"!=typeof a.title&&$("li#"+e+" h4").text(a.title),t.text(l),t.attr("disabled",!1),$(s).fadeOut("slow",function(){$(n).fadeIn("fast",function(){setTimeout(function(){$(n).fadeOut("slow")},500)})})},"json")}),$(document).on("click","#soliloquy-import-submit",function(o){$(this).next().css("display","inline-block"),0===$("#soliloquy-config-import-slider").val().length&&(o.preventDefault(),$(this).next().hide(),alert(soliloquy_metabox["import"]))}),$(document).on("change","#soliloquy-config-slider-size",function(){var o=$(this),t=o.val(),l=o.find(":selected").data("soliloquy-width"),e=o.find(":selected").data("soliloquy-height");"default"==t&&($("#soliloquy-config-slider-width").val(soliloquy_metabox.width),$("#soliloquy-config-slider-height").val(soliloquy_metabox.height)),l&&$("#soliloquy-config-slider-width").val(l),e&&$("#soliloquy-config-slider-height").val(e)});var p=function(){var o=0;return function(t,l){clearTimeout(o),o=setTimeout(t,l)}}(),f=function(o){o.preventDefault(),$("#soliloquy-upload-ui").appendTo("#soliloquy-upload-ui-wrapper").hide(),e()};$(document).on("click","#soliloquy-upload-ui .media-modal-close, #soliloquy-upload-ui .media-modal-backdrop",f),$(document).on("keydown",function(o){27==o.keyCode&&f(o)})})}(jQuery);