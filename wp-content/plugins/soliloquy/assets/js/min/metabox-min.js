!function($){$(function(){function o(o){$(".media-toolbar-secondary span.soliloquy-spinner").css("visibility","visible"),$.post(soliloquy_metabox.ajax,{action:"soliloquy_load_library",offset:o,post_id:soliloquy_metabox.id,search:$("input#soliloquy-slider-search").val(),nonce:soliloquy_metabox.load_slider},function(l){$("a.soliloquy-load-library").attr("data-soliloquy-offset",Number(o)+20),$(".media-toolbar-secondary span.soliloquy-spinner").css("visibility","hidden"),0===o?$(".soliloquy-slider").html(l.html):$(".soliloquy-slider").append(l.html)},"json")}function l(o){var l="";return l+='<div class="soliloquy-video-slide-holder"><p class="no-margin-top"><a href="#" class="button button-secondary soliloquy-delete-video-slide" title="'+soliloquy_metabox.removeslide+'">'+soliloquy_metabox.removeslide+'</a><label for="soliloquy-video-slide-'+o+'-title"><strong>'+soliloquy_metabox.videoslide+'</strong></label><br /><input type="text" class="soliloquy-video-slide-title" id="soliloquy-video-slide-'+o+'-title" value="" placeholder="'+soliloquy_metabox.videoplace+'" /></p><p><label for="soliloquy-video-slide-'+o+'"><strong>'+soliloquy_metabox.videotitle+'</strong></label><br /><input type="text" class="soliloquy-video-slide-url" id="soliloquy-video-slide-'+o+'" value="" placeholder="'+soliloquy_metabox.videooutput+'" /></p><p><label for="soliloquy-video-slide-'+o+'-thumbnail"><strong>'+soliloquy_metabox.videothumb+'</strong></label><br /><input type="text" class="soliloquy-video-slide-thumbnail soliloquy-src" id="soliloquy-video-slide-'+o+'-thumbnail" value="" placeholder="'+soliloquy_metabox.videosrc+'" /> <span><a href="#" class="soliloquy-thumbnail button button-primary" data-field="soliloquy-src">'+soliloquy_metabox.videoselect+'</a> <a href="#" class="soliloquy-thumbnail-delete button button-secondary" data-field="soliloquy-src">'+soliloquy_metabox.videodelete+'</a></span></p><p class="no-margin-bottom"><label for="soliloquy-video-slide-'+o+'-caption"><strong>'+soliloquy_metabox.videocaption+'</strong></label><br /><textarea class="soliloquy-video-slide-caption" id="soliloquy-video-slide-'+o+'-caption"></textarea></p></div>'}function e(o){var l="";return l+='<div class="soliloquy-html-slide-holder"><p class="no-margin-top"><a href="#" class="button button-secondary soliloquy-delete-html-slide" title="'+soliloquy_metabox.removeslide+'">'+soliloquy_metabox.removeslide+'</a><label for="soliloquy-html-slide-'+o+'-title"><strong>'+soliloquy_metabox.htmlslide+'</strong></label><br /><input type="text" class="soliloquy-html-slide-title" id="soliloquy-html-slide-'+o+'-title" value="" placeholder="'+soliloquy_metabox.htmlplace+'" /></p><p class="no-margin-bottom"><label for="soliloquy-html-slide-'+o+'"><strong>'+soliloquy_metabox.htmlcode+'</strong></label><br /><textarea class="soliloquy-html-slide-code" id="soliloquy-html-slide-'+o+'">'+soliloquy_metabox.htmlstart+"</textarea></div>"}function t(){var o={action:"soliloquy_refresh",post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.refresh_nonce};$(".soliloquy-media-library").after('<span class="spinner soliloquy-spinner soliloquy-spinner-refresh"></span>'),$(".soliloquy-spinner-refresh").css({display:"inline-block","margin-top":"-3px"}),$.post(soliloquy_metabox.ajax,o,function(o){o&&o.success&&($("#soliloquy-output").html(o.success),$("#soliloquy-output").find(".wp-editor-wrap").each(function(o,l){var e=$(l).find(".quicktags-toolbar");if(!(e.length>0)){var t=$(l).attr("id").split("-"),i=t.slice(3,-1).join("-");quicktags({id:"soliloquy-caption-"+i,buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()}}),$(".soliloquy-html").find(".soliloquy-html-code").each(function(o,l){var e=$(l).attr("id");p[e]=CodeMirror.fromTextArea(l,{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"solarized dark"}),p[e].on("blur",function(o){$("#"+e).text(o.getValue())}),p[e].refresh()}),$("#soliloquy-output").trigger({type:"soliloquyRefreshed",html:o.success,id:soliloquy_metabox.id})),$(".soliloquy-spinner-refresh").fadeOut(300,function(){$(this).remove()})},"json")}function i(){$("#soliloquy .drag-drop-inside").append('<div class="soliloquy-progress-bar"><div></div></div>'),c=new plupload.Uploader(soliloquy_metabox.plupload);var o=$("#soliloquy .soliloquy-progress-bar"),l=$("#soliloquy .soliloquy-progress-bar div"),e=$("#soliloquy-output");c&&($("#soliloquy .max-upload-size").append(' <a class="soliloquy-media-library button button-primary" href="#" title="'+soliloquy_metabox.slider+'" style="vertical-align: baseline;">'+soliloquy_metabox.slider+"</a>"),c.bind("Init",function(o){var l=$("#soliloquy-plupload-upload-ui");o.features.dragdrop&&!$(document.body).hasClass("mobile")?(l.addClass("drag-drop"),$("#soliloquy-drag-drop-area").bind("dragover.wp-uploader",function(){l.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){l.removeClass("drag-over")})):(l.removeClass("drag-drop"),$("#soliloquy-drag-drop-area").unbind(".wp-uploader")),"html4"==o.runtime&&$(".upload-flash-bypass").hide()}),c.init(),c.bind("FilesAdded",function(l,e){var t=104857600,i=parseInt(l.settings.max_file_size,10);$("#soliloquy-upload-error").html(""),$(o).show().css("display","block"),plupload.each(e,function(o){i>t&&o.size>t&&"html5"!=l.runtime&&a(l,o,!0)}),l.refresh(),l.start()}),c.bind("UploadProgress",function(o,e){$(l).css("width",o.total.percent+"%")}),c.bind("FileUploaded",function(o,l,e){$.post(soliloquy_metabox.ajax,{action:"soliloquy_load_image",nonce:soliloquy_metabox.load_image,id:e.response,post_id:soliloquy_metabox.id},function(o){t()},"json")}),c.bind("UploadComplete",function(){$(o).hide().css("display","none"),$(l).removeAttr("style")}),c.bind("Error",function(o,l){var e=104857600,t=$("#soliloquy-upload-error"),i;switch(l.code){case plupload.FAILED:case plupload.FILE_EXTENSION_ERROR:t.html('<p class="error">'+pluploadL10n.upload_failed+"</p>");break;case plupload.FILE_SIZE_ERROR:a(o,l.file);break;case plupload.IMAGE_FORMAT_ERROR:wpFileError(l.file,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:wpFileError(l.file,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:wpFileError(l.file,pluploadL10n.image_dimensions_exceeded);break;case plupload.GENERIC_ERROR:wpQueueError(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:i=parseInt(uploader.settings.max_file_size,10),i>e&&l.file.size>e?wpFileError(l.file,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")):wpQueueError(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:wpQueueError(pluploadL10n.http_error);break;case plupload.INIT_ERROR:$(".media-upload-form").addClass("html-uploader");break;case plupload.SECURITY_ERROR:wpQueueError(pluploadL10n.security_error);break;default:a(o,l.file)}o.refresh()}))}function a(o,l,e){var t;t=e?pluploadL10n.big_upload_queued.replace("%s",l.name)+" "+pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>"):pluploadL10n.file_exceeds_size_limit.replace("%s",l.name),$("#soliloquy-upload-error").html('<div class="error fade"><p>'+t+"</p></div>"),o.removeFile(l)}var s=$("#soliloquy-tabs"),n=$("#soliloquy-tabs-nav"),d=window.location.hash,r=window.location.hash.replace("!","");if(d&&d.indexOf("soliloquy-tab-")>=0){$(".soliloquy-active").removeClass("soliloquy-active"),n.find('li a[href="'+r+'"]').parent().addClass("soliloquy-active"),s.find(r).addClass("soliloquy-active").show();var u=$("#post").attr("action");u&&(u=u.split("#")[0],$("#post").attr("action",u+d))}$("input,select").conditional(),$(document).on("click","#soliloquy-tabs-nav li a",function(o){o.preventDefault();var l=$(this);if(!l.parent().hasClass("soliloquy-active")){window.location.hash=d=this.hash.split("#").join("#!");var e=n.find(".soliloquy-active").removeClass("soliloquy-active").find("a").attr("href");l.parent().addClass("soliloquy-active"),s.find(e).removeClass("soliloquy-active").hide(),s.find(l.attr("href")).addClass("soliloquy-active").show();var t=$("#post").attr("action");t&&(t=t.split("#")[0],$("#post").attr("action",t+d))}});var c;$('input[name="_soliloquy[type]"]').length>0&&"default"==$('input[name="_soliloquy[type]"]:checked').val()&&i(),0!==$(".soliloquy-helper-needed").length&&$('<div class="soliloquy-meta-helper-overlay" />').prependTo("#soliloquy"),$(document).on("click",".soliloquy-meta-icon",function(o){o.preventDefault();var l=$(this),e=l.parent(),t=l.next();t.is(":visible")?($(".soliloquy-meta-helper-overlay").remove(),e.removeClass("soliloquy-helper-active")):(0===$(".soliloquy-meta-helper-overlay").length&&$('<div class="soliloquy-meta-helper-overlay" />').prependTo("#soliloquy"),e.addClass("soliloquy-helper-active"))}),$(document).on("change",'input[name="_soliloquy[type]"]:radio',function(o){var l=$(this);$(".soliloquy-type-spinner .soliloquy-spinner").css({display:"inline-block","margin-top":"-1px"});var e={action:"soliloquy_change_type",post_id:soliloquy_metabox.id,type:l.val(),nonce:soliloquy_metabox.change_nonce};$.post(soliloquy_metabox.ajax,e,function(o){"default"==o.type?($("#soliloquy-slider-main").html(o.html),i()):$("#soliloquy-slider-main").html(o.html),$(document).trigger("soliloquySliderType",o),$(".soliloquy-type-spinner .soliloquy-spinner").hide()},"json")}),$(document).on("click",".soliloquy-media-library",function(o){o.preventDefault(),$("#soliloquy-upload-ui").appendTo("body").show()}),$(".soliloquy-slider").on("click",".thumbnail, .check, .media-modal-icon",function(o){o.preventDefault(),$(this).parent().parent().hasClass("soliloquy-in-slider")||($(this).parent().parent().hasClass("selected")?$(this).parent().parent().removeClass("details selected"):$(this).parent().parent().addClass("details selected"))}),$(document).on("click","a.soliloquy-load-library",function(l){o($("a.soliloquy-load-library").attr("data-soliloquy-offset"))}),$(".soliloquy-slider").bind("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight&&o($("a.soliloquy-load-library").attr("data-soliloquy-offset"))}),$(document).on("keyup keydown","#soliloquy-slider-search",function(){v(function(){o(0)})}),$(document).on("click",".soliloquy-media-insert",function(o){o.preventDefault();var l=$(this),e=l.text(),t={action:"soliloquy_insert_slides",nonce:soliloquy_metabox.insert_nonce,post_id:soliloquy_metabox.id,images:{},videos:{},html:{}},i=!1,a=!1,s=!1,n=o;l.text(soliloquy_metabox.inserting),$(".soliloquy-media-frame").find(".attachment.selected:not(.soliloquy-in-slider)").each(function(o,l){t.images[o]=$(l).attr("data-attachment-id"),i=!0}),$(".soliloquy-media-frame").find(".soliloquy-video-slide-holder").each(function(o,l){t.videos[o]={title:$(l).find(".soliloquy-video-slide-title").val(),url:$(l).find(".soliloquy-video-slide-url").val(),src:$(l).find(".soliloquy-video-slide-thumbnail").val(),caption:$(l).find(".soliloquy-video-slide-caption").val()},a=!0}),$(".soliloquy-media-frame").find(".soliloquy-html-slide-holder").each(function(o,l){t.html[o]={title:$(l).find(".soliloquy-html-slide-title").val(),code:$(l).find(".soliloquy-html-slide-code").val()},s=!0}),$.post(soliloquy_metabox.ajax,t,function(o){setTimeout(function(){_(n),l.text(e),i&&$(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click")},500)},"json")}),$(document).on("click",".soliloquy-media-frame .media-menu-item",function(o){o.preventDefault();var l=$(this),e=l.parent().find(".active").removeClass("active").data("soliloquy-content"),t=l.addClass("active").data("soliloquy-content");$("#soliloquy-"+e).hide(),$("#soliloquy-"+t).show()}),$(document).on("click",".soliloquy-add-video-slide",function(o){o.preventDefault();var e=parseInt($(this).attr("data-soliloquy-video-number")),t="soliloquy-video-slide-"+$(this).attr("data-soliloquy-html-number");$(this).attr("data-soliloquy-video-number",e+1).parent().before(l(e))}),$(document).on("click","#soliloquy-video-slides .soliloquy-delete-video-slide",function(o){o.preventDefault(),$(this).parent().parent().remove()});var p={};$(".soliloquy-html").find(".soliloquy-html-code").each(function(o,l){var e=$(l).attr("id");p[e]=CodeMirror.fromTextArea(l,{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"solarized dark"}),p[e].on("blur",function(o){$("#"+e).text(o.getValue())}),p[e].on("change",function(o){f(e,o.getValue())})}),$(document).on("click",".soliloquy-add-html-slide",function(o){o.preventDefault();var l=parseInt($(this).attr("data-soliloquy-html-number")),t="soliloquy-html-slide-"+$(this).attr("data-soliloquy-html-number");$(this).attr("data-soliloquy-html-number",l+1).parent().before(e(l)),p[t]=CodeMirror.fromTextArea(document.getElementById(t),{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"solarized dark"}),p[t].on("blur",function(o){$("#"+t).text(o.getValue())}),p[t].on("change",function(o){f(t,o.getValue())})});var m=$("#soliloquy-output");m.sortable({containment:"#soliloquy",items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",update:function(o,l){var e={url:soliloquy_metabox.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_sort_images",order:m.sortable("toArray").toString(),post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.sort},success:function(o){},error:function(o,l,e){}};$.ajax(e)}}),$(document).on("click","#soliloquy .soliloquy-remove-slide",function(o){o.preventDefault();var l=confirm(soliloquy_metabox.remove);if(l){var e=$(this).parent().attr("id"),t={action:"soliloquy_remove_slide",attachment_id:e,post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.remove_nonce};$.post(soliloquy_metabox.ajax,t,function(o){$("#"+e).fadeOut("normal",function(){$(this).remove(),$(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click")})},"json")}});var y=[];$(document).on("click.soliloquyModify",".soliloquy-modify-slide",function(o){o.preventDefault();var l=$(this).parent().data("soliloquy-slide"),e="soliloquy-meta-"+l;y=[],$("ul#soliloquy-output li").each(function(){y.push($(this).data("soliloquy-slide"))}),q(l,e)}),$(document).on("click","button.left, button.right",function(o){o.preventDefault(),b();var l=$(this).attr("data-attachment-id"),e="soliloquy-meta-"+l;q(l,e)});var h,q=function(o,l){h=$("#"+l).appendTo("body"),$(h).show(),$("button.left",$(h)).removeClass("disabled"),$("button.right",$(h)).removeClass("disabled");for(var e=-1,t=0;t<y.length;t++)if(y[t]==o){e=t;break}0==e?($("button.left",$(h)).addClass("disabled"),$("button.left",$(h)).attr("data-attachment-id",""),y.length>1?($("button.right",$(h)).removeClass("disabled"),$("button.right",$(h)).attr("data-attachment-id",y[e+1])):($("button.right",$(h)).addClass("disabled"),$("button.right",$(h)).attr("data-attachment-id",""))):e==y.length-1?($("button.left",$(h)).removeClass("disabled"),$("button.left",$(h)).attr("data-attachment-id",y[e-1]),$("button.right",$(h)).addClass("disabled"),$("button.right",$(h)).attr("data-attachment-id","")):($("button.left",$(h)).removeClass("disabled"),$("button.left",$(h)).attr("data-attachment-id",y[e-1]),$("button.right",$(h)).removeClass("disabled"),$("button.right",$(h)).attr("data-attachment-id",y[e+1])),"undefined"!=typeof p["soliloquy-code-"+o]&&p["soliloquy-code-"+o].refresh()};$(document).on("click",".soliloquy-thumbnail",function(o){o.preventDefault();var l=$(this).data("field"),e=wp.media.frames.soliloquy_media_frame=wp.media({className:"media-frame soliloquy-media-frame",frame:"select",multiple:!1,title:soliloquy_metabox.videoframe,library:{type:"image"},button:{text:soliloquy_metabox.videouse}}),t=$(this);e.on("select",function(){var o=e.state().get("selection").first().toJSON();$("input."+l,t.closest(".media-frame-content")).val(o.url).trigger("change")}),e.open()}),$(document).on("change","input.soliloquy-src, input.soliloquy-thumb",function(o){var l=$(this).data("soliloquy-meta");$("div.thumbnail > img."+l,$(this).closest(".media-frame-content")).attr("src",$(this).val())}),$(document).on("click",".soliloquy-thumbnail-delete",function(o){o.preventDefault();var l=$(this).data("field");$("input."+l,$(this).closest(".media-frame-content")).val("").trigger("change")});var f=function(o,l){var e=o.replace("soliloquy-code-","#soliloquy-meta-table-");$(".attachment-media-view .thumbnail",$(e)).html(l)};$(document).on("click",".media-modal-close, .media-modal-backdrop",function(o){o.preventDefault(),b()}),$(document).on("keydown",function(o){27==o.keyCode&&b()});var b=function(){var o=$(h).attr("id");if("undefined"==typeof o)$("#soliloquy-upload-ui").appendTo("#soliloquy-upload-ui-wrapper").hide();else{var l=o.replace("soliloquy-meta-","");$("#"+o).appendTo("#"+l).hide()}};$(document).on("click",".soliloquy-meta-submit",function(o){o.preventDefault();var l=$(this),e=l.text(),t=l.data("soliloquy-item"),i="soliloquy-meta-"+t,a={},s=$("span.settings-save-status span.spinner"),n=$("span.settings-save-status span.saved");l.text(soliloquy_metabox.saving),l.attr("disabled","disabled"),$(s).show(),a.caption=$("#soliloquy-meta-table-"+t).find('textarea[name="_soliloquy[meta_caption]"]').val(),$("#soliloquy-meta-table-"+t).find(":input,select").not(".ed_button").each(function(o,l){$(this).data("soliloquy-meta")&&("checkbox"==$(this).attr("type")||"radio"==$(this).attr("type")?a[$(this).data("soliloquy-meta")]=$(this).is(":checked")?1:0:"select"==$(this).attr("type")?a[$(this).data("soliloquy-meta")]=$(this).find(":selected").val():a[$(this).data("soliloquy-meta")]=$(this).val())});var d={action:"soliloquy_save_meta",nonce:soliloquy_metabox.save_nonce,attach_id:t,post_id:soliloquy_metabox.id,meta:a};$.post(soliloquy_metabox.ajax,d,function(o){"undefined"!=typeof a.src&&$("li#"+t+" img").attr("src",a.src),"undefined"!=typeof a.title&&$("li#"+t+" h4").text(a.title),l.text(e),l.attr("disabled",!1),$(s).fadeOut("slow",function(){$(n).fadeIn("fast",function(){setTimeout(function(){$(n).fadeOut("slow")},500)})})},"json")}),$(document).on("click","#soliloquy-import-submit",function(o){$(this).next().css("display","inline-block"),0===$("#soliloquy-config-import-slider").val().length&&(o.preventDefault(),$(this).next().hide(),alert(soliloquy_metabox["import"]))}),$(document).on("change","#soliloquy-config-slider-size",function(){var o=$(this),l=o.val(),e=o.find(":selected").data("soliloquy-width"),t=o.find(":selected").data("soliloquy-height");"default"==l&&($("#soliloquy-config-slider-width").val(soliloquy_metabox.width),$("#soliloquy-config-slider-height").val(soliloquy_metabox.height)),e&&$("#soliloquy-config-slider-width").val(e),t&&$("#soliloquy-config-slider-height").val(t)});var v=function(){var o=0;return function(l,e){clearTimeout(o),o=setTimeout(l,e)}}(),_=function(o){o.preventDefault(),$("#soliloquy-upload-ui").appendTo("#soliloquy-upload-ui-wrapper").hide(),t()};$(document).on("click","#soliloquy-upload-ui .media-modal-close, #soliloquy-upload-ui .media-modal-backdrop",_),$(document).on("keydown",function(o){27==o.keyCode&&_(o)})})}(jQuery);