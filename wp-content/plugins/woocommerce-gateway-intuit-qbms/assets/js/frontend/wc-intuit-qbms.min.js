/*!
 * WooCommerce Intuit QBMS
 * Version 1.0
 *
 * Copyright (c) 2013-2016, SkyVerge, Inc.
 * Licensed under the GNU General Public License v3.0
 * http://www.gnu.org/licenses/gpl-3.0.html
 */
jQuery(document).ready(function(a){"use strict";function b(b){if(b.is(".processing"))return!1;var e=a(".payment_method_intuit_qbms"),f=e.find(".js-wc-payment-gateway-payment-token:checked").val();if(f)return!0;var g=[],h=e.find(".js-wc-payment-gateway-account-number").val(),i=e.find(".js-wc-payment-gateway-csc").val(),j=e.find(".js-wc-payment-gateway-card-exp-month").val(),k=e.find(".js-wc-payment-gateway-card-exp-year").val();h=h.replace(/-|\s/g,""),h?((h.length<12||h.length>19)&&g.push(intuit_qbms_params.card_number_length_invalid),/\D/.test(h)&&g.push(intuit_qbms_params.card_number_digits_invalid),c(h)||g.push(intuit_qbms_params.card_number_invalid)):g.push(intuit_qbms_params.card_number_missing);var l=(new Date).getFullYear();return(/\D/.test(j)||/\D/.test(k)||j>12||1>j||l>k||k>l+20)&&g.push(intuit_qbms_params.card_exp_date_invalid),"undefined"!=typeof i&&(i?(/\D/.test(i)&&g.push(intuit_qbms_params.cvv_digits_invalid),(i.length<3||i.length>4)&&g.push(intuit_qbms_params.cvv_length_invalid)):g.push(intuit_qbms_params.cvv_missing)),g.length>0?(d(b,g),!1):(e.find(".js-wc-payment-gateway-account-number").val(h),!0)}function c(a){var b,c,d,e=0;for(b=0,c=a.length;c-1>b;b++)d=parseInt(a.substr(c-(b+2),1)*(2-b%2),10),e+=10>d?d:d-9;return parseInt(a.substr(c-1),10)===(10-e%10)%10}function d(b,c){a(".woocommerce-error, .woocommerce-message").remove(),b.prepend('<ul class="woocommerce-error"><li>'+c.join("</li><li>")+"</li></ul>"),b.removeClass("processing").unblock(),b.find(".input-text, select").blur(),a("html, body").animate({scrollTop:b.offset().top-100},1e3)}function e(){a("input.js-wc-intuit-qbms-payment-token").change(function(){var b=a("input.js-wc-intuit-qbms-payment-token:checked").val(),c=a("div.js-wc-intuit-qbms-new-payment-method-form");b?(c.slideUp(200),intuit_qbms_params.require_csc&&a(".js-wc-intuit-qbms-new-payment-method-form").after(a(".js-wc-intuit-qbms-csc").parent())):(c.slideDown(200),intuit_qbms_params.require_csc&&a(".js-wc-intuit-qbms-csc-clear").before(a(".js-wc-intuit-qbms-csc").parent()))}).change(),a("input#createaccount").change(function(){var b=a("input.js-wc-intuit-qbms-tokenize-payment-method").closest("p.form-row");a(this).is(":checked")?(b.slideDown(),b.next().show()):(b.hide(),b.next().hide())}).change()}a("form.checkout").length?(a("body").bind("updated_checkout",function(){e()}),a("form.checkout").bind("checkout_place_order_intuit_qbms",function(){return b(a(this))})):(e(),a("form#order_review").submit(function(){return"intuit_qbms"===a("#order_review input[name=payment_method]:checked").val()?b(a(this)):void 0}))});
