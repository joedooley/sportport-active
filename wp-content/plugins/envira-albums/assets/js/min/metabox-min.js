var selectedObjs;jQuery(document).ready(function($){function a(a){var e=$(a).data("envira-conditional").split(","),t=!1;switch($(a).attr("type")){case"checkbox":t=$(a).is(":checked");break;default:t=""==$(a).val()||0==$(a).val()?!1:!0}for(var l=0;l<e.length;l++)t?$("#"+e[l]).fadeIn(300):$("#"+e[l]).fadeOut(300)}if($("ul#envira-album-drag-drop-area").length>0){var e=$("ul#envira-album-drag-drop-area"),t=$("ul#envira-album-output"),l=$("#envira-gallery-main"),i=$(".envira-gallery-meta-container"),n={helper:"clone",connectToSortable:"#envira-album-drag-drop-area",revert:"invalid"};$("input[data-envira-conditional], select[data-envira-conditional]").each(function(){a(this)}),$("input[data-envira-conditional], select[data-envira-conditional]").change(function(){a(this)}),$(e).sortable({stop:function(a,e){$("p.drag-drop-info").hide();var l=e.item;galleryID=$(l).data("envira-gallery"),e.item.removeClass("selected"),setTimeout(function(){$("li[data-envira-gallery='"+galleryID+"']",$(t)).remove()},100)}}),$(e).on("sortupdate",function(){var a=[];$.each($(e).children(),function(e,t){a.push($(t).data("envira-gallery"))}),$("input[name=galleryIDs]").val(a.join(",")),$.ajax({url:envira_albums_metabox.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_albums_sort_galleries",galleryIDs:$("input[name=galleryIDs]").val(),post_id:envira_albums_metabox.id,nonce:envira_albums_metabox.sort},success:function(a){},error:function(a,e,t){}})}),$("li",$(t)).draggable(n);var r=null;$("input#envira-albums-gallery-search").keyup(function(){r&&window.clearTimeout(r),r=window.setTimeout(function(){r=null;var a=$("input#envira-albums-gallery-search").val();(a.length>=3||0==a.length)&&$.ajax({url:envira_albums_metabox.ajax,type:"post",async:!0,cache:!1,data:{action:"envira_albums_search_galleries",search_terms:a,post_id:envira_albums_metabox.id,nonce:envira_albums_metabox.search},success:function(a){a.length>0&&($(t).html(a),$("li",$(t)).draggable(n))},error:function(a,e,t){}})},500)}),$("input#envira-albums-gallery-search").on("search",function(){$.ajax({url:envira_albums_metabox.ajax,type:"post",async:!0,cache:!1,data:{action:"envira_albums_search_galleries",search_terms:"",post_id:envira_albums_metabox.id,nonce:envira_albums_metabox.search},success:function(a){a.length>0&&($(t).html(a),$("li",$(t)).draggable(n))},error:function(a,e,t){}}),r=null}),$("ul#envira-album-output").on("click","li.gallery",function(){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected"),$("ul#envira-album-output > li.selected").length>0?$("a.envira-galleries-add").fadeIn():$("a.envira-galleries-add").fadeOut()}),$("a.envira-galleries-add").click(function(a){a.preventDefault(),$("ul#envira-album-output > li.selected").each(function(){$("p.drag-drop-info").hide(),$(this).removeClass("selected").appendTo($(e)),$(e).trigger("sortupdate"),$("a.envira-galleries-add").fadeOut()})}),$(l).on("click",".envira-album-remove-gallery",function(a){a.preventDefault();var l=confirm(envira_albums_metabox.remove);l&&($(this).parent().appendTo($(t)).draggable(n),$(e).trigger("sortupdate"))});var s=[];$(l).on("click",".envira-album-modify-gallery",function(a){a.preventDefault();var e=$(this).parent().data("envira-gallery");s=[],$("ul#envira-album-drag-drop-area li.gallery").each(function(){s.push($(this).data("envira-gallery"))}),d(e)}),$("body").on("click","button.left, button.right",function(a){a.preventDefault(),u();var e=$(this).attr("data-gallery-id");d(e)});var o,d=function(a){o=$("#envira-gallery-meta-"+a).appendTo("body"),$(o).show(),$("button.left",$(o)).removeClass("disabled"),$("button.right",$(o)).removeClass("disabled");for(var e=-1,t=0;t<s.length;t++)if(s[t]==a){e=t;break}0==e?($("button.left",$(o)).addClass("disabled"),$("button.left",$(o)).attr("data-gallery-id",""),s.length>1?($("button.right",$(o)).removeClass("disabled"),$("button.right",$(o)).attr("data-gallery-id",s[e+1])):($("button.right",$(o)).addClass("disabled"),$("button.right",$(o)).attr("data-gallery-id",""))):e==s.length-1?($("button.left",$(o)).removeClass("disabled"),$("button.left",$(o)).attr("data-gallery-id",s[e-1]),$("button.right",$(o)).addClass("disabled"),$("button.right",$(o)).attr("data-gallery-id","")):($("button.left",$(o)).removeClass("disabled"),$("button.left",$(o)).attr("data-gallery-id",s[e-1]),$("button.right",$(o)).removeClass("disabled"),$("button.right",$(o)).attr("data-gallery-id",s[e+1])),$(document).on("click",".media-modal-close, .media-modal-backdrop",function(a){a.preventDefault(),u()}),$(document).on("keydown",function(a){27==a.keyCode&&u()})},u=function(){var a=$(o).attr("id"),e=a.split("-"),t=e[e.length-1];$("#"+a).appendTo('li[data-envira-gallery="'+t+'"]').hide()};$("body").on("click",".attachment",function(a){var e=$(this).data("cover-image-id"),t=$(this).data("cover-image-url");console.log(e),console.log(t),$(".attachment",$(this).closest("div.attachment-details")).removeClass("details").removeClass("selected"),$(this).addClass("details").addClass("selected"),"undefined"!=typeof e&&$("input.envira-gallery-cover-image-id",$(this).closest("div.attachment-details")).val(e),"undefined"!=typeof t&&$("input.envira-gallery-cover-image-url",$(this).closest("div.attachment-details")).val(t)}),$("body").on("click",".envira-gallery-meta-submit",function(a){a.preventDefault();var e=$(this).data("envira-gallery-item"),t=$(this).closest("#envira-gallery-meta-"+e),l=$(this),i=l.text(),n=$("span.settings-save-status span.spinner",$(t)),r=$("span.settings-save-status span.saved",$(t)),s=$("input.envira-gallery-title",$(t)).val(),o=$('textarea[name="_eg_album_data[galleries]['+e+'][caption]"]',$(t)).val(),d=$("input.envira-gallery-alt",$(t)).val(),u=$("input.envira-gallery-cover-image-id",$(t)).val(),c=$("input.envira-gallery-cover-image-url",$(t)).val();l.text(envira_albums_metabox.saving),l.attr("disabled","disabled"),$(n).show(),$.ajax({url:envira_albums_metabox.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_albums_update_gallery",title:s,caption:o,alt:d,cover_image_id:u,cover_image_url:c,post_id:envira_albums_metabox.id,gallery_id:e,nonce:envira_albums_metabox.sort},success:function(a){var s=$("li.selected img",$(t)).attr("src");$("ul#envira-album-drag-drop-area li[data-envira-gallery='"+e+"'] > img").attr("src",s),l.text(i),l.attr("disabled",!1),$(n).fadeOut("slow",function(){$(r).fadeIn("fast",function(){setTimeout(function(){$(r).fadeOut("slow")},500)})})},error:function(a,e,t){alert(a.responseText)}})})}});