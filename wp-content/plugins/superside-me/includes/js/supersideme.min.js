/**
 * SuperSide Me main js engine
 * @package   SuperSideMe
 * @author    Robin Cornett <hello@robincornett.com>
 * @copyright 2015-2017 Robin Cornett
 * @license   GPL-2.0+
 */
!function(e,n,a){"use strict";function s(e){t(e),(O.params.search.button||C())&&r(),0!==_.button.length&&(n(_.button).on("click.supersideme",function(){i()}),n("undefined"!==O.params.second.button)&&n(O.params.second.button).on("click.second-ssme",function(){f(O.params.second)}),n(window).on("resize.supersideme",E).triggerHandler("resize.supersideme"))}function t(e){var a=O.params.navarialabel,s=W.screenReader,t=n(O.params.location).length>0?O.params.location:"body";O.params.navigation&&(a=O.params.navigation,s="label"),C()&&(a=parent.wp.customize.instance("supersideme[navigation]").get());var r=n("<button />",{role:"button","aria-pressed":!1,"aria-expanded":!1,"aria-controls":I.panel,id:e,"class":W.menuButton}).append(n("<span />",{"class":s,text:a}));n(t)[O.params["function"]](r),n("body").addClass(W.body)}function r(){if(O.params.search.input){var e=O.params.search.button_aria,a=W.screenReader,s="left"===O.params.side?"after":"before";O.params.search.button_text&&(e=O.params.search.button_text,a="label"),C()&&(e=parent.wp.customize.instance("supersideme[search_button_text]").get());var t=n("<button />",{role:"button","aria-pressed":!1,id:W.searchButton,"class":W.searchButton}).append(n("<span />",{"class":a,text:e}));O.params.location&&"body"!==O.params.location&&n(O.params.location).length||n(_.button).wrap("<div />"),n(_.button).parent().addClass(W.buttonWrap),n(_.button)[s](t);var r=n(_.buttonWrap),i="after",o="last-of-type",u=n(_.searchButton),p="";"0px"===r.css("bottom")&&n.inArray(r.css("position"),["absolute","fixed"])>-1&&(i="before",o="first-of-type",p=-5),n(_.buttonWrap+" > button:"+o)[i](O.params.search.input),n(_.searchInput).css("display","none").css("order",p),O.params.search.button||u.css("display","none"),u.on("click.search",function(){n(_.searchInput).slideToggle(200),T(u,"aria-pressed")})}}function i(){m(),S=!0,n.sidr("open",I.panel)}function o(){return n.sidr("close",I.panel),n(_.sidr+" "+_.submenuToggle).removeClass(W.menuOpen).attr("aria-expanded",!1).next(".sub-menu").slideUp("fast"),!1}function u(e){var a=n("body");return x(e)?void a.removeClass(W.body):void a.addClass(W.body)}function p(){if(0!==I.panel.length&&x(I.panel)){var n=e.getElementById(I.panel);n.style.setProperty("display","block")}}function d(e,a){return x(e)?void n(a).swipe("disable"):(n(a).swipe("enable"),void c(n(a)))}function l(e){var a=O.skipLinks.startLink,s=e,t=n(O.skipLinks.ulClass+' a[href*="#'+O.skipLinks.contains+'"]').not('a[href*="'+O.skipLinks.unique+'"]');x(e)?(a=e,s=O.skipLinks.startLink,n(t).removeAttr("style")):n(t).hide();var r=n(O.skipLinks.ulClass+' a[href*="#'+a+'"]'),i=n(r).attr("href");i&&(i=i.replace(a,s),n(r).attr("href",i))}function c(e){var n=i,a=o;"left"===O.params.side&&(n=o,a=i),e.swipe({allowPageScroll:"vertical",threshold:120,swipeLeft:n,swipeRight:a,preventDefaultEvents:!1})}function m(){var a=null!==O.params.source&&null!==e.getElementById(O.params.source)?"#"+O.params.source:function(){h()},s={button:_.menuButton,source:a,panel:I.panel,side:O.params.side},t=n(I.panel+" "+_.submenuToggle);return b(n(s.button),s),0===t.length&&(v(),y(),n(_.sidr+" "+_.submenuToggle).on("click.supersideme-submenu",k)),w(s.panel),n.sidr("open",s.panel),!1}function f(e){var a=n(e.button);return b(a,e),w(e.panel),n.sidr("open",e.panel),!1}function b(e,n){e.sidr({name:n.panel,side:n.side,source:n.source,renaming:!1,displace:O.params.displace,speed:parseInt(O.params.speed,10),onOpen:function(){e.toggleClass(W.menuOpen),T(e,"aria-pressed"),T(e,"aria-expanded"),g(e)},onClose:function(){e.removeClass(W.menuOpen),T(e,"aria-pressed"),T(e,"aria-expanded"),S=!1}})}function g(e){var a=n(_.sidr),s=a.children(),t=s.first(),r=s.last();a.attr({tabindex:"0"}).focus(),a.on("keydown.sidrNav",function(n){if(9===n.keyCode)return(r[0]!==n.target||n.shiftKey)&&(t[0]!==n.target&&a[0]!==n.target||!n.shiftKey)?void 0:(e.focus(),!1)}),e.on("keydown.sidrNav",function(n){if(9===n.keyCode)return e[0]!==n.target||n.shiftKey?void 0:(t.focus(),!1)})}function h(){var e=O.params.html5?"nav":"div",a=O.params.html5?{"class":"side-navigation",role:"navigation",itemscope:"itemscope",itemtype:"http://schema.org/SiteNavigationElement"}:{"class":"side-navigation"},s=n("<"+e+" />",a).append(n("<ul />",{"class":"side-nav"})),t=n("<div />",{"class":"sidr-inner"}),r={widget:".supersideme.widget-area",inner:_.panel+" "+_.sidr+"-inner"};0===n(r.inner).length&&(n(_.sidr).prepend(t),O.params.search.panel&&(n(r.inner).prepend(O.params.search.input),"0"===O.params.search_on&&n(".search-me").css("display","none")),O.params.menus&&(n(r.inner).append(s),n(".side-nav").prepend(O.params.menus)),p(),0!==n(r.widget).length&&n(r.widget).appendTo(r.inner).attr("style","display:block;"))}function v(){var e=n("<button />",{role:"button","aria-pressed":!1,"aria-label":O.params.subarialabel,"class":W.submenuToggle}).append(n("<span />",{"class":W.screenReader,text:O.params.submenu}));0===n(_.sidr+" "+_.submenuToggle).length&&(n(_.sidr+" .sub-menu").before(e),L(_.sidr+" .menu-item-has-children > a",_.sidr+" "+_.submenuToggle))}function y(){var e=n(_.sidr+' .menu-item-has-children > a[href="#"]');e.addClass(W.submenuToggle).attr("role","button").attr("aria-pressed",!1).next(_.submenuToggle).remove()}function k(){var e=n(this),a=e.closest(".menu-item").siblings();T(e,"aria-pressed"),e.toggleClass(W.menuOpen),e.next(".sub-menu").slideToggle("fast"),a.find(_.submenuToggle).removeClass(W.menuOpen).attr("aria-pressed",!1),a.find(".sub-menu").slideUp("fast")}function w(e){var a=e.indexOf("#")<=0?"#"+e:e;0===n(a+" .menu-close").length&&n(a+" "+_.sidr+"-inner").prepend(O.params.close),n(O.params.closeevent).on("click",function(){n(this).attr("aria-pressed",!1),n.sidr("close",e),n(_.sidr+" "+_.submenuToggle).removeClass(W.menuOpen).attr("aria-expanded",!1).next(".sub-menu").slideUp("fast")})}function x(n){var a=e.getElementById(n),s=window.getComputedStyle(a);return"none"===s.getPropertyValue("display")}function T(e,n){e.attr(n,function(e,n){return"false"===n})}function C(){return Boolean(O.params.search_on)}function B(e,n,a){var s;return function(){var t=this,r=arguments,i=function(){s=null,a||e.apply(t,r)},o=a&&!s;clearTimeout(s),s=setTimeout(i,n),o&&e.apply(t,r)}}function L(e,a){n(a).css("height",n(e).outerHeight())}var O={},S=!1,I={button:"slide-menu",panel:"side-menu"},W={sidr:"sidr",menuButton:"slide-nav-link",submenuToggle:"sub-menu-toggle",menuOpen:"menu-open",searchButton:"ssme-search",buttonWrap:"ssme-buttons",screenReader:"screen-reader-text",body:"supersideme"},_={sidr:"."+W.sidr,panel:"#"+I.panel,menuButton:"."+W.menuButton,submenuToggle:"."+W.submenuToggle,button:"#"+I.button,searchButton:"."+W.searchButton,buttonWrap:"."+W.buttonWrap,searchInput:"."+W.buttonWrap+" .search-me"};O.init=function(){s(I.button)};var E=B(function(){var e=I.button;u(e),O.params.swipe&&d(e,"body"),O.skipLinks="undefined"==typeof supersidemeSkipLinks?"":supersidemeSkipLinks,"undefined"!=typeof O.skipLinks&&l(e),x(e)&&(n(_.searchInput).hide(),o())},250);n(e).ready(function(){O.params="undefined"==typeof SuperSideMeVar?"":SuperSideMeVar,"undefined"!=typeof O.params&&O.init()})}(document,jQuery);